# バージョン管理ガイド

Shogi-Aho-AI プロジェクトのバージョン管理完全ガイド。

---

## バージョニングスキーム

このプロジェクトは [セマンティックバージョニング](https://semver.org/) に従います: `MAJOR.MINOR.PATCH`

```
v0.5.0
  │ │ │
  │ │ └─ PATCH: バグ修正、性能改善
  │ └─── MINOR: 新機能、後方互換性のある変更
  └───── MAJOR: 破壊的変更、大規模リファクタリング
```

---

## バージョン更新ガイドライン

### PATCH (0.5.0 → 0.5.1)

**使用時**: バグ修正、性能改善、ドキュメント更新

**例**:

- ✅ PST インデックス計算バグの修正
- ✅ スレッドプール設定の最適化
- ✅ README ドキュメントの更新
- ✅ タイポや書式の修正
- ✅ API を変更しない性能調整
- ✅ 軽微な lint 修正

**コマンド**:

```bash
python3 scripts/bump_version.py patch
```

---

### MINOR (0.5.0 → 0.6.0)

**使用時**: 新機能、重要な改善、後方互換性のある変更

**例**:

- ✅ 新しい分析ツールの追加
- ✅ 新しいコマンドラインオプション
- ✅ 新しい盤面設定タイプ
- ✅ Self-Play 機能の強化
- ✅ 新しい AI 強度レベル
- ✅ UI 改善
- ✅ 新しい評価器機能

**コマンド**:

```bash
python3 scripts/bump_version.py minor
```

---

### MAJOR (0.5.0 → 1.0.0)

**使用時**: 破壊的変更、大規模リファクタリング、互換性のない変更

**例**:

- ✅ コアゲームロジック API の変更
- ✅ 非推奨機能の削除
- ✅ 大規模アーキテクチャリファクタリング
- ✅ ファイル形式の変更 (互換性破壊)
- ✅ 最初の安定版リリース (0.x.x → 1.0.0)

**コマンド**:

```bash
python3 scripts/bump_version.py major
```

---

## ワークフロー

### 標準ワークフロー

```bash
# 1. 変更を加える
# 2. 徹底的にテスト
# 3. バージョン更新
python3 scripts/bump_version.py [patch|minor|major]

# 4. 変更をコミット
git add Cargo.toml
git commit -m \"chore: バージョンを X.Y.Z に更新\"
```

### クイックワークフロー (自動コミット)

```bash
# バージョン更新とコミットを一度に
python3 scripts/bump_version.py minor --commit -m \"feat: 新機能追加\"
```

### ドライラン (プレビュー)

```bash
# ファイルを変更せずにプレビュー
python3 scripts/bump_version.py patch --dry-run
```

---

## バージョン履歴

### 0.5.0 (2026-01-07) - 現在

**主要な機能強化**:

#### 評価関数改善 (+210-360 Elo)

1. **モビリティ評価** (+100-150 Elo)

   - 駒の活動性スコアリング
   - 重み付けされた手 (キャプチャ、プロモーション)

2. **ゲームフェーズ検出** (+50-100 Elo)

   - 序盤/中盤/終盤の認識
   - フェーズ固有の戦略

3. **強化キング安全性** (+30-50 Elo)

   - 逃げ場所のカウント
   - 敵攻撃駒の検出

4. **戦術パターン** (+20-40 Elo)

   - パスポーン検出
   - ビショップペアボーナス
   - オープンファイル上のルーク

5. **駒組みスコアリング** (+10-20 Elo)
   - 序盤の駒の展開

#### ML データ品質改善

- **データ拡張**: 対称盤面の水平反転
- **強化ラベル**: material_diff, game_lengths, evaluations, critical_moments
- **HDF5 スキーマ**: 新しいメタデータフィールドで拡張
- **圧縮**: gzip 圧縮 (~50% ストレージ削減)

#### UI 強化

- **リプレイ機能**: スクロール可能な棋譜ファイルセレクター
- **複数ディレクトリ**: `kifu/` と `selfplay_results/` の両方をスキャン
- **メタデータ表示**: 盤面タイプ、プレイヤー、手数、タイムスタンプ
- **新フィールド**: Evaluator、モデルパス、バージョン情報

#### ドキュメント

- `docs/` フォルダに整理
- 包括的な改善ガイドを追加
- ナビゲーション用の INDEX.md 作成

**変更ファイル**: 15+  
**新規ファイル**: 10+  
**ビルド時間**: ~6s

---

### 0.4.0 (2026-01-07)

**機能**:

- 埋め込みメタデータ付き ML モデルバージョニング
- マルチモデルサポート (プラグ可能な評価器)
- `ort` 2.0 API に更新

> [!NOTE]
> ML モデルは ONNX メタデータに独立したバージョニングを持つ

---

### 0.3.2 (2026-01-06)

**修正**:

- 重大な PST インデックスバグ修正 (40% → 50% 勝率バランス)
- スレッドプール最適化 (8 コアで 6 スレッド)
- ai_config.json をデフォルトにリセット

**ツール**:

- 包括的な分析ツールを追加
- 詳細分析スクリプト
- 盤面可視化

---

### 0.3.1 (2026-01-05)

**機能**:

- Self-Play 改善
- 分析機能強化
- 性能最適化

---

### 0.3.0 (2026-01-04)

**機能**:

- 千日手検出 (繰り返し)
- AI バランス改善
- ネットワークプレイサポート

---

### 0.2.0 (2026-01-03)

**機能**:

- チェス駒の実装
- 混合盤面設定
- ルールの可変性

---

### 0.1.0 (2026-01-02)

**初期リリース**:

- 基本将棋実装
- TUI インターフェース
- ローカルプレイサポート

---

## ML モデルのバージョニング

**アプリケーションバージョンとは別**

ML モデルは ONNX メタデータに埋め込まれた独自のバージョニングを持つ:

```
models/
├── Fair/
│   ├── v0.1.0/
│   │   ├── model.onnx
│   │   ├── model.pt
│   │   └── README.md
│   ├── v0.2.0/
│   └── v0.3.0/
├── ShogiOnly/
│   └── v0.1.0/
└── ...
```

**モデルバージョン形式**: `v{major}.{minor}.{patch}`

**モデルバージョン更新タイミング**:

- **Patch**: ハイパーパラメータ調整、同じアーキテクチャ
- **Minor**: アーキテクチャ変更、より多くの訓練データ
- **Major**: 完全な再設計

詳細は [docs/ML_USAGE.md](./ML_USAGE.md) 参照。

---

## ヒントとベストプラクティス

### 更新前

1. **徹底的にテスト**: `cargo build --release` を実行して変更をテスト
2. **変更を確認**: `git diff` で何が変わったか確認
3. **ドキュメント更新**: 重要な変更を文書化
4. **テスト実行**: テストがあれば `cargo test`

### 更新中

1. **dry-run を使用**: まず `--dry-run` でプレビュー
2. **正しいレベルを選択**: 迷ったら低いレベル (minor より patch)
3. **明確なメッセージ**: 何が変わったか、なぜ変わったか説明

### 更新後

1. **リリースタグ**: `git tag v0.5.0`
2. **タグをプッシュ**: `git push origin v0.5.0`
3. **CHANGELOG 更新**: CHANGELOG.md に記録 (存在する場合)
4. **アナウンス**: README やリリースノートを更新

---

## バージョン比較

### 機能マトリックス

| 機能               | v0.1.0 | v0.3.0 | v0.5.0 |
| ------------------ | ------ | ------ | ------ |
| 基本将棋           | ✅     | ✅     | ✅     |
| チェス駒           | ❌     | ✅     | ✅     |
| ネットワークプレイ | ❌     | ✅     | ✅     |
| ML サポート        | ❌     | ✅     | ✅     |
| 千日手             | ❌     | ✅     | ✅     |
| 強化評価           | ❌     | ❌     | ✅     |
| リプレイ UI        | ❌     | ❌     | ✅     |
| データ拡張         | ❌     | ❌     | ✅     |

### 性能比較

| バージョン | 評価強度     | ビルド時間 | バイナリサイズ |
| ---------- | ------------ | ---------- | -------------- |
| v0.1.0     | ベースライン | ~3s        | ~5MB           |
| v0.3.0     | +100 Elo     | ~4s        | ~6MB           |
| v0.5.0     | +360 Elo     | ~6s        | ~7MB           |

---

## Q&A とトラブルシューティング

### 複数の変更がある場合は?

最も高い適用レベルを使用:

- バグ修正 + 新機能 = **minor**
- 複数の機能 = **minor**
- 機能 + 破壊的変更 = **major**

### どのレベルか分からない場合は?

**経験則**:

- 動作が変わった? → patch
- 新機能? → minor
- 破壊的変更? → major

### 更新を忘れた場合は?

```bash
# 今更新して最後のコミットに修正
python3 scripts/bump_version.py patch
git add Cargo.toml
git commit --amend --no-edit
```

---

## 関連ドキュメント

- [ML 使用法](./ML_USAGE.md) - ML モデルバージョニング
- [索引](./INDEX.md) - ドキュメント概要
- [改善](./improvements/) - 機能ドキュメント

---

**最終更新**: 2026-01-07  
**現在バージョン**: 0.5.0  
**次の計画**: 0.6.0 (計画機能は未定)
